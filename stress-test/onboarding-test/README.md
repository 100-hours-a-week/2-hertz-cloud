로그인 페이지에서 카카오 소셜 로그인 → 개인정보 입력 페이지에서 개인정보 입력 → 취향 선택 페이지에서 취향 선택하여 등록 → 저장 → AI 서버로 유저 등록 요청 

→ **사용자 등록** → **관심도 임베딩**

# 1. 테스트 개요

| 항목 | 내용 |
| --- | --- |
| 테스트 목적 | 채팅방 입장 후 메시지 수신(SSE)의 처리 성능 검증 |
| 테스트 환경 | GCP e2-standard-4 (4vCPU / 16GB RAM), Ubuntu 22.04 |
| 대상 시스템 | Next.js (프론트) + Spring Boot (백엔드) + Redis |
| 테스트 도구 | Apache JMeter 5.6.3 |
| 테스트 일시 | 2025년 5월 10일 오전 10:00 ~ 10:30 |

---

## 2. 사용자 시나리오 설명

**시나리오 ID**: S1

**설명**: 사용자가 채팅방에 입장하여, 실시간 메시지를 수신하는 흐름

**행동 흐름**:

1. 채팅방 페이지 진입
2. `GET /api/chat/room/{id}/sse` 호출하여 SSE 연결 수립
3. 서버에서 메시지를 push할 경우 SSE로 실시간 메시지 수신

---

## 3. 테스트 API 및 호출 흐름

| 출 순서 | API 엔드포인트 | 메서드 | 설명 |
| --- | --- | --- | --- |
| 1 | /api/v1/users | POST | 사용자 가입 요청 (성별, 나이, 취향 등 포함) |

---

## 4. 테스트 조건 및 부하 프로파일

| 항목 | 값 |
| --- | --- |
| 동시 사용자 수 | 3명 |
| 총 요청 수 | 정확히 30회 |
| 부하 생성 패턴 | shared-iterations (고정 개수 요청 배분) |
| 테스트 최대 지속 시간 | 2분 (여유 있는 실행 시간 설정) |
| 배치 처리 방식 | 멀티스레드 활용, 동시 요청 처리 |
| 데이터 다양성 | 랜덤 생성된 사용자 프로필 사용 |

---

## 5. 테스트 결과 요약

| 지표 | 값 |
| --- | --- |
| 총 요청 수 | 30건 |
| 성공 요청 수 | 30건 (100%) |
| 충돌(Conflict) 요청 수 | 0건 (0%) |
| 유효성 검증 오류 수 | 0건 (0%) |
| 타임아웃 요청 수 | 0건 (0%) |
| 최소 응답 시간 | 1.10초 |
| 평균 응답 시간 | 4.92초 |
| 중간값 응답 시간 | 5.04초 |
| 90% 응답 시간(p90) | 6.56초 |
| 95% 응답 시간(p95) | 6.74초 |
| 최대 응답 시간 | 6.75초 |
| 서버 CPU 사용률 | 평균: 54%, 최대: 97% |
| 메모리 사용량 | Python 프로세스: ~1.1GB, Chroma 프로세스: ~95MB |

### CPU 사용률 분석

- 테스트 동안 CPU 사용률은 평균 54%로 유지되었으며, 최대 97%까지 상승
- 대부분의 구간에서 60~80% 사이에서 변동
- 요청 처리 시 CPU 사용률이 급증했다가, 요청 처리가 완료된 후 감소하는 패턴
- 일부 구간에서는 CPU 사용률이 95% 이상으로 상승하여 CPU 병목 현상 발생 가능성 관찰

### 메모리 사용 패턴

- Python 프로세스의 메모리 사용량은 테스트 동안 안정적으로 유지
- 각 요청마다 생성되는 Chroma 프로세스의 메모리 사용량은 약 95MB로 일관됨
- 총 시스템 메모리 사용량은 안정적이며 메모리 누수 징후는 발견되지 않음

---

## 6. 발견된 문제점

| 문제 항목 | 설명 | 영향도 | 우선순위 |
| --- | --- | --- | --- |
| 높은 응답 시간 | 평균 응답 시간 4.92초는 일반적인 웹 서비스 기준으로 높은 편 | 중 | 중 |
| 응답 시간 변동성 | 최소 1.10초에서 최대 6.75초까지 변동, p95가 6.74초로 일부 사용자 경험 저하 가능 | 중 | 중 |
| CPU 사용률 급증 | 요청 처리 시 CPU 사용률이 95% 이상으로 급증하는 구간 발생 | 상 | 상 |
| 프로세스 생성 패턴 | 각 요청마다 새로운 Chroma 프로세스 생성으로 리소스 오버헤드 발생 | 중 | 상 |

---

## 7. 개선 방안 제안

- **답 시간 최적화:**
    - 회원가입 프로세스의 병렬 처리 가능한 부분 식별 및 최적화
    - 데이터베이스 쿼리 및 연산 작업 최적화
- **프로세스 관리 개선:**
    - 요청마다 새 Chroma 프로세스를 생성하는 대신 프로세스 풀 도입
    - 기존 Chroma 프로세스 재사용을 통한 리소스 효율성 향상
- **CPU 최적화:**
    - 무거운 연산 작업 비동기 처리 도입
    - 병렬 처리 시 코어 수에 맞게 최적화된 동시 요청 수 조정
- **서버 스케일링:**
    - 부하 증가 시 자동 스케일링 메커니즘 적용
    - 마이크로서비스 아키텍처 도입으로 특정 기능 분리 및 부하 분산

---

## 8. 부록

- 테스트 스크립트: `/home/devops/ai-service-test.js`
- 테스트 로그: `/home/devops`/server_metrics.log